{"version":3,"sources":["jscript.js","jscript1.js"],"names":["Container","this","id","className","htmlCode","Basket","call","countGoods","amount","basket_items","retreive","prototype","render","Object","create","constructor","basketItems","$","append","get","url","context","success","response","result","basket","length","basketData","basketDetails","refresh","alert","error_message","dataType","add","idProduct","quantity","itemPrice","i","items","id_product","price","push","delete","splice","empty","text","item","undefined","document","ready","on"],"mappings":"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","file":"../total.js","sourcesContent":["function Container() {\n  this.id = '';\n  this.className = '';\n  this.htmlCode = '';\n}\n\nContainer.prototype.render = function() {\n  return this.htmlCode;\n}\n\nfunction Basket() {\n  Container.call(this);  \n  this.id = 'basket';\n  this.countGoods = 0;\n  this.amount = 0;  \n  this.basket_items = [];  \n  this.retreive();\n}\n\nBasket.prototype = Object.create(Container.prototype);\nBasket.prototype.constructor = Basket;\n\nBasket.prototype.render = function() {\n  var basketItems = $('<div/>', {\n    id: this.id + '_items'\n  });\n  $('#' + this.id).append(basketItems);\n}\n\nBasket.prototype.retreive = function() {  \n  $.get({\n    url: 'basket/get/json.txt',\n    context: this,\n    success: function(response) {\n\n      if(response.result === 1) {\n        this.countGoods = response.basket.length;\n        this.basket_items = response.basket;\n        this.amount = response.amount;\n        var basketData = $('<div/>', {\n          id: 'basket_data'\n        });    \n        var basketDetails = $('<div/>', {\n          id: 'basket_details'\n        });\n           \n        $('#' + this.id).append(basketData);\n        $('#' + this.id).append(basketDetails);\n        this.refresh();\n      }\n\n      if(response.result === 0) {\n        alert(response.error_message);\n      }\n\n    },\n    dataType: 'json'\n  })\n}\n\nBasket.prototype.add = function(idProduct, quantity) {\n  $.get({\n    url: 'basket/add/json.txt',\n    context: this,\n    success: function(response) {\n\n      if(response.result === 1) {\n        var itemPrice;\n        for (var i in response.items) {\n          if (response.items[i].id_product == idProduct) {\n            itemPrice = response.items[i].price;\n            break;\n          }\n        }\n        this.countGoods += quantity;\n        this.amount += itemPrice * quantity;\n\n        //если товар добавлялся, увеличим колво, если не добавлялся, добавим в массив\n        for (var i in this.basket_items) {\n          if (this.basket_items[i].id_product == idProduct) {\n            this.basket_items[i].quantity += quantity;            \n            break;\n          } else if (i == this.basket_items.length - 1) {\n            this.basket_items.push({\n              id_product: idProduct,\n              price: itemPrice,\n              quantity: quantity\n            });\n          }\n        }\n\n        if (this.basket_items.length == 0) {\n            this.basket_items.push({\n              id_product: idProduct,\n              price: itemPrice,\n              quantity: quantity\n            });\n        }\n        this.refresh();\n      }\n\n      if(response.result === 0) {\n        alert(response.error_message);\n      }\n\n    },\n    dataType: 'json'\n  })\n}\n\nBasket.prototype.delete = function(idProduct, quantity) {\n  $.get({\n    url: 'basket/add/json.txt',\n    context: this,\n    success: function(response) {\n\n      if(response.result === 1) {\n        //если товара >1 уменьшим колво, если 1 уберем из корзины\n        for (var i in this.basket_items) {\n          if (this.basket_items[i].id_product == idProduct) {\n            this.basket_items[i].quantity -= quantity;\n            this.countGoods -= quantity;\n            this.amount -= this.basket_items[i].price * quantity;\n            if (this.basket_items[i].quantity == 0) {\n              this.basket_items.splice(i, 1);\n            }\n            break;\n          } else if (i == this.basket_items.length - 1) {\n            alert(\"Такого товара нет в корзине\");\n          }\n        }\n\n        if (this.basket_items.length == 0) {\n           alert(\"Корзина пуста\");\n        }\n        this.refresh();\n      }\n\n      if(response.result === 0) {\n        alert(response.error_message);\n      }\n\n    },\n    dataType: 'json'\n  })\n}\n\nBasket.prototype.refresh = function() {\n  var basketData = $('#basket_data');\n  var basketDetails = $('#basket_details');\n  basketData.empty();\n  basketDetails.empty();\n  basketData.text('Товаров в корзине на общую сумму - ' + this.amount + ' рублей');\n  for (var i in this.basket_items) {\n    var item = $('<div/>', {\n      id: 'basket_item'\n    });\n    if (this.basket_items[i].quantity == undefined) {\n      this.basket_items[i].quantity = 1;\n    }\n    item.text('Товар с id ' + this.basket_items[i].id_product + \" по цене \" + this.basket_items[i].price + \n      ' рублей' + ' в количестве ' + this.basket_items[i].quantity);      \n    $('#basket_details').append(item);\n  }  \n}\n\n","    $(document).ready(function(){\n      var basket = new Basket();\n      $(\"#buy1\").on(\"click\", function() {\n        basket.add(111, 1);\n      });\n      $(\"#buy2\").on(\"click\", function() {\n        basket.add(222, 1);\n      });\n      $(\"#buy3\").on(\"click\", function() {\n        basket.add(333, 1);\n      });\n      $(\"#buy4\").on(\"click\", function() {\n        basket.add(444, 1);\n      });\n\n      $(\"#cancel1\").on(\"click\", function() {\n        basket.delete(111, 1);\n      });\n      $(\"#cancel2\").on(\"click\", function() {\n        basket.delete(222, 1);\n      });\n      $(\"#cancel3\").on(\"click\", function() {\n        basket.delete(333, 1);\n      });\n      $(\"#cancel4\").on(\"click\", function() {\n        basket.delete(444, 1);\n      });\n    });"]}